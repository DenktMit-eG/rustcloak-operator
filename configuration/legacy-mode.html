<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Legacy Mode - Rustcloak Operator</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../toc.js"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Rustcloak Operator</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/withlazers/rustcloak-operator/" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                        <a href="https://github.com/withlazers/rustcloak-operator/edit/main/docs/src/configuration/legacy-mode.md" title="Suggest an edit" aria-label="Suggest an edit">
                            <i id="git-edit-button" class="fa fa-edit"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="legacy-mode"><a class="header" href="#legacy-mode">Legacy Mode</a></h1>
<p>Rustcloak supports a mode called "legacy mode" in which it can control
the CRDs of the <a href="https://github.com/keycloak/keycloak-realm-operator">keycloak-realms-operator</a>.</p>
<p>Please note that Rustcloak cannot run alongside the
keycloak-realm-operator. It is a good idea to remove all objects
managed by the old controller before starting Rustcloak and redeploying
it for rustcloak to take over.</p>
<p>To enable legacy mode, enabled the <code>legacy: &lt;mode&gt;</code> option in the rustcloak
helm chart.</p>
<p>Rustcloak supports two legacy mode modes it can operate in:</p>
<ul>
<li><code>all</code> mode: Rustcloak will manage all legacy keycloak objects</li>
<li><code>prudent</code> mode: Rustcloak will manage only the keycloak objects that have the
<code>rustcloak.k8s.eboland.de/handle: "true"</code> annotation.</li>
</ul>
<p>With <code>disabled</code> mode, rustcloak will not manage any legacy keycloak objects. This is the default.</p>
<p>rustcloak will manage the following legacy keycloak objects:</p>
<ul>
<li><a href="https://github.com/keycloak/keycloak-realm-operator/blob/main/deploy/examples/external-keycloak.yaml">legacy-<code>ExternalKeycloak</code></a>: a shim for <a href="../crds/keycloakinstance.html">KeycloakInstance</a></li>
<li><a href="https://github.com/keycloak/keycloak-realm-operator/blob/main/deploy/examples/realm-legacy/example-realm.yaml">legacy-<code>KeycloakRealm</code></a>: a shim for <a href="../crds/keycloakrealm.html">KeycloakRealm</a></li>
<li><a href="https://github.com/keycloak/keycloak-realm-operator/blob/main/deploy/examples/example-client.yaml">legacy-<code>KeycloakClient</code></a>: a shim for <a href="../crds/keycloakclient.html">KeycloakClient</a></li>
<li><a href="https://github.com/keycloak/keycloak-realm-operator/blob/main/deploy/examples/example-user.yaml">legacy-<code>KeycloakUser</code></a>: a shim for <a href="../crds/keycloakuser.html">KeycloakUser</a></li>
</ul>
<div class=warning>
rustcloak will not roll out legacy CRDs. You need to create them manually.
</div>
<h2 id="managing-legacy-objects"><a class="header" href="#managing-legacy-objects">Managing legacy objects</a></h2>
<p>Rustcloak can handle whole trees of legacy objects. The discovery of parent objects is
done by selectors, using the <a href="https://github.com/keycloak/keycloak-realm-operator/blob/main/deploy/examples/external-keycloak.yaml">legacy-<code>ExternalKeycloak</code></a> resource as a root object.</p>
<p>But most of the time you actually want to use the rustcloak resources instead and just
use the legacy mode while migrating larger setups to Rustcloak. For that, rustcloak
allows you to overwrite define the <code>rustcloak.k8s.eboland.de/*Ref</code> annotations on the legacy objects
that point to the rustcloak parent resources.</p>
<p>Example:</p>
<p>Given that you have a <a href="https://github.com/keycloak/keycloak-realm-operator/blob/main/deploy/examples/realm-legacy/example-realm.yaml">legacy-<code>KeycloakRealm</code></a> resource in rustcloak:</p>
<pre><code class="language-yaml">apiVersion: rustcloak.k8s.eboland.de/v1
kind: KeycloakRealm
metadata:
  name: example-keycloakrealm
spec:
  instanceRef: keycloak-instance
  definition:
    realm: an-example-realm
    displayName: An Example Realm
</code></pre>
<p>You can now create a <a href="https://github.com/keycloak/keycloak-realm-operator/blob/main/deploy/examples/example-client.yaml">legacy-<code>KeycloakClient</code></a> resource:</p>
<pre><code class="language-yaml">apiVersion: legacy.k8s.keycloak.org/v1alpha1
kind: KeycloakClient
metadata:
  annotations:
    rustcloak.k8s.eboland.de/realmRef: example-keycloakrealm
  name: example-keycloakclient
spec:
  client:
    clientId: example-client
    name: example-client
  realmSelector:
    matchLabels: {}
</code></pre>
<p>rustloak will now manage the <a href="https://github.com/keycloak/keycloak-realm-operator/blob/main/deploy/examples/example-client.yaml">legacy-<code>KeycloakClient</code></a> resource as if it was a child of
the <a href="../crds/keycloakrealm.html"><code>KeycloakRealm</code></a> resource. Note that if you run rustcloak in <code>prudent</code> mode,
you need to add the <code>rustcloak.k8s.eboland.de/handle: "true"</code> annotation to
the <a href="https://github.com/keycloak/keycloak-realm-operator/blob/main/deploy/examples/example-client.yaml">legacy-<code>KeycloakClient</code></a> resource.</p>
<p>If the <code>realmRef</code> annotation is not set, rustcloak will try to discover the parent object using the <code>realmSelector</code> field.
This only works if the parent object is a legacy resource.</p>
<p>The following annotations are supported:</p>
<ul>
<li>for <a href="https://github.com/keycloak/keycloak-realm-operator/blob/main/deploy/examples/realm-legacy/example-realm.yaml">legacy-<code>KeycloakRealm</code></a>:
<ul>
<li><code>rustcloak.k8s.eboland.de/instanceRef</code>: The name of the <a href="../crds/keycloakinstance.html"><code>KeycloakInstance</code></a> resources</li>
<li><code>rustcloak.k8s.eboland.de/handle</code>: If set to <code>true</code>, rustcloak will manage the object in <code>prudent</code> mode</li>
</ul>
</li>
<li>for <a href="https://github.com/keycloak/keycloak-realm-operator/blob/main/deploy/examples/example-client.yaml">legacy-<code>KeycloakClient</code></a>:
<ul>
<li><code>rustcloak.k8s.eboland.de/realmRef</code>: The name of the <a href="../crds/keycloakrealm.html"><code>KeycloakRealm</code></a> resources</li>
<li><code>rustcloak.k8s.eboland.de/handle</code>: If set to <code>true</code>, rustcloak will manage the object in <code>prudent</code> mode</li>
</ul>
</li>
<li>for <a href="https://github.com/keycloak/keycloak-realm-operator/blob/main/deploy/examples/example-user.yaml">legacy-<code>KeycloakUser</code></a>:
<ul>
<li><code>rustcloak.k8s.eboland.de/realmRef</code>: The name of the <a href="../crds/keycloakrealm.html"><code>KeycloakRealm</code></a> resources</li>
<li><code>rustcloak.k8s.eboland.de/handle</code>: If set to <code>true</code>, rustcloak will manage the object in <code>prudent</code> mode</li>
</ul>
</li>
<li>for <a href="https://github.com/keycloak/keycloak-realm-operator/blob/main/deploy/examples/external-keycloak.yaml">legacy-<code>ExternalKeycloak</code></a>:
<ul>
<li><code>rustcloak.k8s.eboland.de/handle</code>: If set to <code>true</code>, rustcloak will manage the object in <code>prudent</code> mode</li>
</ul>
</li>
</ul>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../configuration.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../configuration/patches.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../configuration.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../configuration/patches.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
